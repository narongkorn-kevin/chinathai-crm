<div class="flex h-screen w-full">
    <!-- Sidebar -->
    <div class="w-1/4 bg-white p-4 border-r">
        <h1 class="text-red-500 text-xl font-bold">{{ 'contact_customers.contact_customers' | transloco }}</h1>
        <input type="text" placeholder="Search" class="mt-4 w-full px-3 py-2 border rounded-md">
        <div class="mt-4 overflow-y-auto h-full">
            <div *ngFor="let value of data"
                class="flex flex-col sm:flex-row items-center p-2 hover:bg-gray-200 cursor-pointer border-b "
                (click)="selectChat(value)">
                <ng-container *ngIf="value.member?.image; else defaultIcon">
                    <img class="w-10 h-10 rounded-full border-2 border-gray-400" [src]="value.member?.image"
                        alt="Profile">
                </ng-container>
                <ng-template #defaultIcon>
                    <mat-icon class="w-10 h-10 rounded-full border-2 border-gray-400">person</mat-icon>
                </ng-template>
                <div class="ml-2">
                    <p class="font-semibold">{{ value.member.fname }} {{ value.member.lname }}</p>
                    <p class="text-sm text-gray-500">
                        <ng-container
                            *ngIf="value.chat_msgs[value.chat_msgs.length - 1]?.type === 'file'; else checkImage">
                            <mat-icon>insert_drive_file</mat-icon>
                        </ng-container>
                        <ng-template #checkImage>
                            <ng-container
                                *ngIf="value.chat_msgs[value.chat_msgs.length - 1]?.type === 'image'; else showMessage">
                                <mat-icon>image</mat-icon>
                            </ng-container>
                        </ng-template>
                        <ng-template #showMessage>
                            {{ value.chat_msgs[value.chat_msgs.length - 1]?.message }}
                        </ng-template>
                    </p>
                </div>
                <span class="ml-auto text-sm text-gray-400">{{ formatDate(value.chat_msgs[value.chat_msgs.length -
                    1]?.created_at) }}</span>
            </div>
        </div>
    </div>

    <!-- Chat Window -->
    <div class="flex-1 flex flex-col">
        <div class="p-4 border-b bg-white flex items-center">
            <ng-container *ngIf="profile?.image; else defaultIcon">
                <img class="w-10 h-10 rounded-full border-2 border-gray-400" [src]="profile?.image" alt="Profile">
            </ng-container>
            <ng-template #defaultIcon>
                <mat-icon class="w-10 h-10 rounded-full border-2 border-gray-400">person</mat-icon>
            </ng-template>
            <p class="ml-2 font-semibold"> {{ profile?.fname }} {{ profile?.fname }}</p>
        </div>
        <div class="flex-1 p-4 overflow-y-auto" #chatContainer>
            <div class="flex flex-col my-1 space-y-2" *ngFor="let chat of selectedChat">
                <div *ngIf="chat.type == 'text'" class="flex flex-col my-1 space-y-2">
                    <div class="bg-gray-300 p-2 rounded-md max-w-xs"
                        *ngIf="chat.member_id !== null && chat.user_id == null">{{ chat.message }}</div>
                    <div class="self-end bg-red-300 p-2 rounded-md max-w-xs"
                        *ngIf="chat.user_id !== null && chat.member_id == null">{{ chat.message }}</div>
                </div>
                <div *ngIf="chat.type == 'image'" class="flex flex-col my-1 space-y-2">
                    <div class="bg-gray-300 p-2 rounded-md max-w-xs" *ngIf="chat.member_id !== null"><img
                            [src]="chat.message" alt="pic"> </div>
                    <div class="self-end bg-red-300 p-2 rounded-md max-w-xs" *ngIf="chat.user_id !== null"><img
                            [src]="chat.message" alt="pic"> </div>
                </div>
                <div *ngIf="chat.type == 'file'" class="flex flex-col my-1 space-y-2">
                    <div class="bg-gray-300 p-2 rounded-md max-w-xs" *ngIf="chat.member_id !== null">
                        <p><a href="{{ chat.message }}" target="_blank"><mat-icon
                                    [svgIcon]="'heroicons_outline:document'"></mat-icon></a></p>
                    </div>
                    <div class="self-end bg-red-300 p-2 rounded-md max-w-xs" *ngIf="chat.user_id !== null">
                        <p><a href="{{ chat.message }}" target="_blank"><mat-icon
                                    [svgIcon]="'heroicons_outline:document'"></mat-icon></a></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="p-4 border-t bg-white flex">
            <input type="text" placeholder="Message" class="flex-1 px-3 py-2 border rounded-md"
                [(ngModel)]="newMessage">
            <button class="ml-2 text-white px-4 py-2 rounded-md" (click)="sendChat()">
                <mat-icon [svgIcon]="'heroicons_outline:paper-airplane'"></mat-icon>
            </button>
            <button class="ml-2 text-white px-4 py-2 rounded-md" (click)="sendImage()">
                <mat-icon [svgIcon]="'heroicons_outline:photo'"></mat-icon>
            </button>
            <button class="ml-2 text-white px-4 py-2 rounded-md" (click)="sendFile()">
                <mat-icon [svgIcon]="'heroicons_outline:paper-clip'"></mat-icon>
            </button>
        </div>
    </div>
</div>

<ng-template #btNg let-data="adtData">
    <button mat-icon-button [color]="'primary'" [matMenuTriggerFor]="menu">
        <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:cog-8-tooth'"></mat-icon>
    </button>
    <mat-menu #menu="matMenu">
        <button mat-menu-item (click)="openDialogEdit(data)">
            <mat-icon [svgIcon]="'mat_outline:edit_note'"></mat-icon>
            <span>{{ 'buttons.edit' | transloco }}</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="clickDelete(data.id)">
            <mat-icon [svgIcon]="'feather:trash'"></mat-icon>
            <span>{{ 'buttons.delete' | transloco }}</span>
        </button>
    </mat-menu>
</ng-template>
